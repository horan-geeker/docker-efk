<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<filter docker.**>
  @type parser
  key_name log
  reserve_data true
  <parse>
    @type json
    time_key time
    time_format %Y-%m-%dT%H:%M:%S%:z
    keep_time_key true
  </parse>
</filter>

<filter docker.**>
  @type geoip

  # Specify one or more geoip lookup field which has ip address (default: host)
  geoip_lookup_keys  ip

  # Set adding field with placeholder (more than one settings are required.)
  <record>
    city            ${city.names.en["ip"]}
    latitude        ${location.latitude["ip"]}
    longitude       ${location.longitude["ip"]}
    country         ${country.iso_code["ip"]}
    country_name    ${country.names.en["ip"]}
    postal_code     ${postal.code["ip"]}
    region_code     ${subdivisions.0.iso_code["ip"]}
    region_name     ${subdivisions.0.names.en["ip"]}
  </record>

  # To avoid get stacktrace error with `[null, null]` array for elasticsearch.
  skip_adding_null_record  true
</filter>

<match docker.**>
  @type copy
  <store>
    @type stdout
  </store>
  <store>
    @type                   elasticsearch
    host                    elasticsearch
    port                    9200
    user                    "#{ENV['ELK_USER']}"
    password                "#{ENV['ELK_PASSWORD']}"
    logstash_format  true
    flush_interval       1s
  </store>
 </match>
